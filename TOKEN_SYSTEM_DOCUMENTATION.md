# Token & Customer Management System

## Overview
I've implemented a comprehensive token and customer management system with the following features:

## ğŸ¯ Key Features Implemented

### 1. **Token Management System**
- **12-character unique tokens** generated by Super Admin
- **Hierarchy-based distribution**: Super Admin â†’ Dealer â†’ Sub Dealer â†’ Salesman
- **Token tracking**: Full assignment chain and status monitoring
- **Status management**: available â†’ assigned â†’ used

### 2. **Separate Customer Table**
- **No login credentials** - Customers are data-only entities
- **Complete product information** with EMI calculations
- **Address management** with proper relationships
- **Document storage** for customer files
- **Status tracking**: active, completed, defaulted, cancelled

### 3. **Hierarchy-Based Token Flow**
```
Super Admin (generates 12-char tokens)
    â†“ distributes to
Dealer (receives tokens)
    â†“ assigns to  
Sub Dealer (receives tokens)
    â†“ assigns to
Salesman (receives tokens)
    â†“ uses for
Customer (consumes token for product purchase)
```

### 4. **Product & EMI Management**
- **Product information**: type, model, price, IMEI tracking
- **EMI calculation**: automatic based on duration and interest
- **Financial tracking**: total payable, interest amount
- **Duration flexibility**: 3-60 months

## ğŸ”§ API Endpoints

### Token Management
```
GET    /api/tokens                    - Get user's tokens
POST   /api/tokens/generate           - Generate tokens (Super Admin)
POST   /api/tokens/assign             - Assign token to subordinate
POST   /api/tokens/distribute         - Bulk distribute to dealers
GET    /api/tokens/statistics         - Token usage stats
GET    /api/tokens/assignable-users   - Users who can receive tokens
```

### Customer Management  
```
GET    /api/customers                 - List customers (hierarchy filtered)
POST   /api/customers                 - Create customer (Salesman only)
GET    /api/customers/{id}            - Customer details
PATCH  /api/customers/{id}/status     - Update customer status
POST   /api/customers/{id}/documents  - Upload documents
GET    /api/customers/statistics      - Customer statistics
```

## ğŸ“Š Database Structure

### Tokens Table
- `code` (12-char unique)
- `created_by` (Super Admin)
- `assigned_to` (Current holder)
- `status` (available/assigned/used)
- `metadata` (assignment chain)

### Customers Table
- Personal info (NID, name, contact)
- Product details (type, model, price, IMEI)
- EMI information (duration, monthly amount)
- Address relationships
- Token reference
- Creator tracking

## ğŸ” Security Features

### Role-Based Access
- **Super Admin**: Generate and distribute tokens, view all data
- **Dealer**: Assign tokens to sub-dealers, view subordinate customers
- **Sub Dealer**: Assign tokens to salesmen, view salesman customers  
- **Salesman**: Use tokens for customers, view own customers only

### Token Protection
- **Hierarchy validation**: Can only assign to lower roles
- **Availability checking**: Tokens must be assigned to user
- **Usage tracking**: Full audit trail of token movement
- **Status enforcement**: Prevents invalid token operations

## ğŸ’¡ Key Improvements

### 1. **Customer Data Separation**
- Customers are NOT users - no login required
- Optimized for data storage and EMI tracking
- Cleaner separation of concerns

### 2. **Token Economy**
- Controlled distribution through hierarchy
- Prevents unauthorized customer creation
- Tracks token utilization and accountability

### 3. **EMI Calculation**
- Automatic interest calculation (15% default)
- Total payable amount tracking
- Monthly payment scheduling

### 4. **Document Management**
- File upload for customer documents
- Secure storage with customer ID organization
- Multiple document types supported

## ğŸš€ Usage Examples

### Super Admin generates tokens:
```json
POST /api/tokens/generate
{
    "quantity": 50
}
```

### Dealer assigns token to Sub Dealer:
```json
POST /api/tokens/assign
{
    "token_code": "ABC123XYZ789",
    "user_id": 123
}
```

### Salesman creates customer:
```json
POST /api/customers
{
    "nid_no": "1234567890123",
    "name": "John Doe",
    "mobile": "01712345678",
    "token_code": "ABC123XYZ789",
    "product_type": "Smartphone",
    "product_price": 25000,
    "emi_duration_months": 12,
    "present_address": {...},
    "permanent_address": {...}
}
```

This system ensures complete accountability, proper hierarchy enforcement, and comprehensive customer data management without mixing user authentication concerns with customer information.